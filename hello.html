<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>查詢公司代號與公司名稱</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f7f7f7; }
    input, select, button { padding: 0.5em; font-size: 1em; margin-top: 0.5em; }
    #result { margin-top: 1em; padding: 1em; background: #fff; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <h2>查詢公司代號與公司名稱</h2>

  <form id="lookupForm">
    <label for="companySelect">選擇公司：</label><br>
    <select id="companySelect" required>
      <option value="">請選擇公司名稱</option>
    </select>
    <br><br>
    <button type="submit">查詢</button>
  </form>

  <div id="result">載入資料中，請稍候...</div>

  <script>
    let companyData = [];

    // Big5 解碼函數
    function decodeBig5(buffer) {
      const decoder = new TextDecoder('big5');
      return decoder.decode(buffer);
    }

    // 載入並處理資料
    fetch('t187ap03_L - t187ap03_L.csv')
      .then(response => response.arrayBuffer())
      .then(buffer => {
        const decodedText = decodeBig5(buffer);
        const parsed = Papa.parse(decodedText, {
          header: true,
          skipEmptyLines: true
        });
        companyData = parsed.data;

        // 將公司資料填入下拉選單
        const select = document.getElementById('companySelect');
        companyData.forEach(item => {
          const option = document.createElement('option');
          option.value = item['公司代號'];
          option.textContent = item['公司簡稱'];
          select.appendChild(option);
        });

        document.getElementById('result').innerText = '請選擇公司查詢。';
      })
      .catch(error => {
        document.getElementById('result').innerText = '載入失敗，請稍後再試。';
        console.error('錯誤訊息：', error);
      });

    // 表單送出事件
    document.getElementById('lookupForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const selectedCode = document.getElementById('companySelect').value;
      const resultDiv = document.getElementById('result');

      const result = companyData.find(item => item['公司代號'] === selectedCode);

      if (result) {
        resultDiv.innerHTML = `<strong>公司代號：</strong>${result['公司代號']}<br>
                               <strong>公司名稱：</strong>${result['公司簡稱']}`;
      } else {
        resultDiv.innerText = '請選擇有效的公司。';
      }
    });
  </script>

</body>
</html>
